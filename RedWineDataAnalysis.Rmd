---
title: "Red Wine Exploration by Justin Rogers"
output: html_document
---

## This report explores which chemical properties influence the quality of red wines.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=8)
```

```{r}
wines <- read.csv("wineQualityReds.csv")
# Remove the columns containing the index
ws <- wines[, c(2:13)]
library("GGally")
library("ggplot2")
library("dplyr")
library(gridExtra)
library(grid)
library(e1071)
library(RColorBrewer)
```

# Univariate Plots Section

The report explores a dataset containing quality and 11 features for 1599 red wines observations.

```{r}
dim(ws)
```

```{r}
str(ws)
```
```{r}
summary(ws)
```
 
```{r}
sapply(ws, function(x) sum(is.na(x)))
```
Looking for the number of NA values for each column in the dataframe. It appears that none are missing.

```{r}
cor(ws[,c(1:11)], ws[,c(12)])
```
Correlation showing all variables against quality. It appears that four attributes have a weak to moderate correlation (either negative or positive) with quality: volatile.acidity, citric.acid, sulphates, and alcohol.

```{r}
cor(ws)
```
Correlations between all variables.
  

```{r}
 ggplot(aes(x = quality), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
```

```{r}
summary(ws$quality)
```
The qualities conform to a fairly normal distribution. While the scores limits were 0-10, no wines fell below 3 or scored above 8 and most falling below a 6.

### Explore the four variables with the highest correlations with quality

```{r}
p1 = ggplot(aes(x = volatile.acidity), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 = ggplot(aes( x = 1, y = volatile.acidity ), data = ws) + 
               geom_jitter(alpha = 0.1) +
               geom_boxplot(alpha = 0.2, color = "#099DD9")
grid.arrange(p1, p2, ncol=2)
```
```{r}
summary(ws$volatile.acidity)
```
```{r}
skewness(ws$volatile.acidity)
```
Volatile acidity is positively skewed.

```{r}
outliers <- boxplot.stats(ws$volatile.acidity)$out
ws_out <- ws
ws_out$outlier <- ifelse(ws_out$volatile.acidity %in% outliers, NA, ws_out$volatile.acidity)
dim(ws)
ws_out <- ws_out[!is.na(ws_out$outlier),]
dim(ws_out)
length(outliers)
cor(ws_out$volatile.acidity, ws_out$quality)
```

```{r}
p1 <- ggplot(aes(x = log10(volatile.acidity + 1)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 <- ggplot(aes(x = sqrt(volatile.acidity)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p3 <- ggplot(aes(x = sqrt(sqrt(volatile.acidity))), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p4 <- ggplot(aes(x = volatile.acidity^1/3), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p5 <- ggplot(aes(x = 1/volatile.acidity), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
grid.arrange(p1, p2, p3, p4, p5,  ncol = 1)
```
Squareroot of squareroot appears to give the best normal distribution.

```{r}
cor(sqrt(sqrt(ws$volatile.acidity)), ws$quality)
```
But it doesn't create a much stronger correlation.

```{r}
p1 = ggplot(aes(x = citric.acid), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 = ggplot(aes( x = 1, y = citric.acid ), data = ws) + 
               geom_jitter(alpha = 0.1) +
               geom_boxplot(alpha = 0.2, color = "#099DD9")
grid.arrange(p1, p2, ncol=2)
```
```{r}
summary(ws$citric.acid)
```
```{r}
skewness(ws$citric.acid)
```
Citric acid appears to be positively skewed, but the jump around .5 reduces the skewness measure.

```{r}
p1 <- ggplot(aes(x = log10(citric.acid + 1)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 <- ggplot(aes(x = sqrt(citric.acid)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p3 <- ggplot(aes(x = sqrt(sqrt(citric.acid))), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p4 <- ggplot(aes(x = citric.acid^1/3), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p5 <- ggplot(aes(x = 1/citric.acid), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
grid.arrange(p1, p2, p3, p4, p5,  ncol = 1)
```
Through all the transforms, it appears that squareroot creates the most normal distribution, but still has a large number of wines with almost no citric acid.
```{r}
cor(sqrt(ws$citric.acid), ws$quality)
```
And the squareroot actually lowers the correlation.

```{r}
p1 = ggplot(aes(x = sulphates), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 = ggplot(aes( x = 1, y = sulphates), data = ws) + 
               geom_jitter(alpha = 0.1) +
               geom_boxplot(alpha = 0.2, color = "#099DD9")
grid.arrange(p1, p2, ncol=2)
```
```{r}
summary(ws$sulphates)
```
```{r}
skewness(ws$sulphates)
```
Sulphates are highly positively skewed.

```{r}
p1 <- ggplot(aes(x = log10(sulphates + 1)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 <- ggplot(aes(x = sqrt(sulphates)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p3 <- ggplot(aes(x = sqrt(sqrt(sulphates))), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p4 <- ggplot(aes(x = sulphates^1/3), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p5 <- ggplot(aes(x = 1/sulphates), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
grid.arrange(p1, p2, p3, p4, p5,  ncol = 1)
```
Reciprical transform shows the best normal distribution.
```{r}
cor(1/(ws$sulphates), ws$quality)
```
This actually increased correlation and turned it negative. We'll explore both options.


```{r}
p1 = ggplot(aes(x = alcohol), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 = ggplot(aes( x = 1, y = alcohol), data = ws) + 
               geom_jitter(alpha = 0.1) +
               geom_boxplot(alpha = 0.2, color = "#099DD9")
grid.arrange(p1, p2, ncol=2)
```
```{r}
summary(ws$alcohol)
```
```{r}
skewness(ws$alcohol)
```
Alcohol has a positive skew.

```{r}
p1 <- ggplot(aes(x = log10(alcohol + 1)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p2 <- ggplot(aes(x = sqrt(alcohol)), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p3 <- ggplot(aes(x = sqrt(sqrt(alcohol))), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p4 <- ggplot(aes(x = alcohol^1/3), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
p5 <- ggplot(aes(x = 1/alcohol), data = ws) + 
  geom_histogram(color = I("black"), fill = I("#099DD9"))
grid.arrange(p1, p2, p3, p4, p5,  ncol = 1)
```
The best normalization is created by the squareroot transform.
```{r}
cor(sqrt(ws$alcohol), ws$quality)
```
No real change in corrlation, but we'll plot both.

# Bivariate Plots Section

```{r}
ggplot(aes(x = quality, y = volatile.acidity), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") +
  scale_x_continuous(limits = c(2,9), breaks = seq(2, 9, 0.5)) +
  geom_smooth(method = "lm")
```
The negative correlation is obvious in the trendline.

```{r}
ggplot(aes(x = quality, y = citric.acid), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") +
  scale_x_continuous(limits = c(2,9), breaks = seq(2, 9, 0.5)) +
  geom_smooth(method = "lm")
```
The weak positive correlation can be seen in the trendline.

```{r}
ggplot(aes(x = quality, y = sulphates), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") +
  scale_x_continuous(limits = c(2,9), breaks = seq(2, 9, 0.5)) +
  geom_smooth(method = "lm")
```
```{r}
ggplot(aes(x = quality, y = 1/(ws$sulphates)), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") +
  scale_x_continuous(limits = c(2,9), breaks = seq(2, 9, 0.5)) +
  geom_smooth(method = "lm")
```
The reciprocal sulphates show a much stronger negative trend with quality.

```{r}
ggplot(aes(x = quality, y = alcohol), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  scale_x_continuous(limits = c(2,9), breaks = seq(2, 9, 0.5)) +
  geom_smooth(method = "lm")
```
```{r}
ggplot(aes(x = quality, y = sqrt(alcohol)), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  scale_x_continuous(limits = c(2,9), breaks = seq(2, 9, 0.5)) +
  geom_smooth(method = "lm")
```
They both appear to have the strongest trendlines we've seen with quality.

Now we'll see see how the four attributes with the hightest correlations with quality correlate with each other.
```{r}
ggplot(aes(x = volatile.acidity, y = citric.acid), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  geom_smooth(method = "lm")
```
```{r}
cor(ws$volatile.acidity, ws$citric.acid)
```
Pretty strong negative correlation between volatile acidity and citric acid, but both of those attributes could be correlated merely because they are acids in the wine. 

```{r}
ggplot(aes(x = volatile.acidity, y = sulphates), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  geom_smooth(method = "lm")
```
```{r}
cor(ws$volatile.acidity, ws$sulphates)
```
Weak correlation between volatile acidity and sulphates.

```{r}
ggplot(aes(x = volatile.acidity, y = alcohol), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  geom_smooth(method = "lm")
```
```{r}
cor(ws$volatile.acidity, ws$alcohol)
```
Weak correlation between volatile acidity and alcohol.

```{r}
ggplot(aes(x = citric.acid, y = sulphates), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  geom_smooth(method = "lm")
```
```{r}
cor(ws$citric.acid, ws$sulphates)
```
Medium correlation between citric acid and sulphates.

```{r}
ggplot(aes(x = citric.acid, y = alcohol), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  geom_smooth(method = "lm")
```
```{r}
cor(ws$citric.acid, ws$alcohol)
```
Very little correlation between citric acid and alcohol.

```{r}
ggplot(aes(x = sulphates, y = alcohol), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  geom_smooth(method = "lm")
```
```{r}
cor(ws$sulphates, ws$alcohol)
```
Very little correlation between sulphates and alchohol.

# Bivariate Analysis

# Multivariate Plots Section

```{r}
ggpairs(ws)
```


# Multivariate Analysis

# Final Plots and Summary
## Plot One
```{r}
ggplot(aes(x = quality, y = alcohol), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  scale_x_continuous(limits = c(3,8.5), breaks = seq(3, 8.5, 0.5)) +
  scale_y_continuous(limits = c(9,13), breaks = seq(9, 13, 0.5)) +
  geom_smooth(method = "lm") +
  labs(title = "Quality by Alcohol Content") +
  xlab("Quality") +
  ylab("Alcohol (% by volume)") +
  theme(plot.title = element_text(hjust = 0.5))
```

## Description One
Alcohol had the highest positive correlation with wine quality. This makes sense as one of the primary reason to have an alcoholic beverage in the first place is for alcohol. At around 7 level quality the vast majority of those wines contain an alcohol percentage greater than 10%.

## Plot Two
```{r}
ggplot(aes(x = quality, y = sulphates), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") +
  scale_x_continuous(limits = c(3,8), breaks = seq(3,8, 0.5)) +
  scale_y_continuous(limits = c(.3,1.25), breaks = seq(.3,1.25, 0.1)) +
  geom_smooth(method = "lm") +
  labs(title = "Quality by Sulphates") +
  xlab("Quality") +
  ylab("Sulphate Level (potassium sulphate - g / dm3)") +
  theme(plot.title = element_text(hjust = 0.5))
```

## Description Two
Sulphates had the second highest positive correlation with quality. Sulphates are additives to wines which acts as antimicrobial and antioxidant agents. These preserve the wines so perhaps an increase in sulphates would produce less likelihood that the wine tasted would have gone bad.

## Plot Three
```{r}
ggplot(aes(x = sulphates, y = alcohol), data = ws) + 
  geom_point(alpha = 5/10, position = position_jitter(h = 0), color = "#099DD9") + 
  scale_x_continuous(limits = c(.3,1.25), breaks = seq(.3,1.25, 0.1)) +
  scale_y_continuous(limits = c(9,14), breaks = seq(9, 14, 0.5)) +
  geom_smooth(method = "lm") +
  labs(title = "Sulphates by Alcohol") +
  xlab("Sulphate Level (potassium sulphate - g / dm3)") +
  ylab("Alcohol (% by volume)") +
  theme(plot.title = element_text(hjust = 0.5))
```

## Description Three
This shows little correlation between the two highest positively correlated attributes to wine quality in the dataset, sulphates and alcohol. Since we're ultimately trying to find the attributes which influence the quality of wine and possibly to predict the quality based on these attributes, it's important that the features are not redundant. Redundant attributes lead to a model which overfits predictions.

# Reflections
As wine quality was pretty much a categorical value containing mostly values of 5 or 6, these highly influenced the appearance of the graphs correlating with quality. I was hoping that some of the transforms would give a higher correlation with quality than just the normal attribute, but I didn't see any real evidence of this with the transforms I created.

Some limitations are due to the volume of data. 1599 records is not a large dataset, perhaps I should have chosen the white wines instead. To investigate the data further, I would like to see a larger set. In addition, while the quality measure was a median of three wine experts, I would also like to see the mean in order to show a more continuous variable quality measurement.